import{d as te,a as ie,r as s,j as e,L as Re,B as k,s as I,e as Na,f as Le,P as ne,g as fe,h as he,i as ba,k as Ca,c as Oe,l as Ue,m as ka,n as Aa,H as ce,M as de}from"./index-CmGxKR2W.js";import{L as A,I as R,u as wa,D as Z,a as J,b as ee,c as ae,d as se,e as Sa}from"./dialog-x9vYFAAS.js";import{C as me,a as ue,b as xe,c as B,d as pe,e as Ia}from"./ChatWindow-CAKZhwK9.js";import{S as Ra,a as Da,b as Ea,c as Pa,V as Ma,d as Ta,u as Fa,T as _a}from"./textarea-DpdPb1qd.js";import{d as Ge,R as za,I as La,T as Oa,a as Ua,b as De,c as Ee}from"./tabs-BD69CF-m.js";import{A as Pe,a as Me,b as Te,S as Ga,F as qa}from"./FeedbackCommentModal-C8Auac7q.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $a=te("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=te("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=te("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Va=te("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),qe=250,Ba=qe*1024,Ha=({onSave:n,onCancel:o})=>{const{currentUser:l,updateUser:p,updateUserImage:d}=ie(),t=l&&l.type==="client"?l:null,[x,C]=s.useState((t==null?void 0:t.name)||""),[u,N]=s.useState((t==null?void 0:t.email)||""),[r,m]=s.useState((t==null?void 0:t.state)||""),[y,f]=s.useState((t==null?void 0:t.phone)||""),[g,v]=s.useState(!1),[w,E]=s.useState(!1);s.useEffect(()=>{t&&(C(t.name),N(t.email),m(t.state),f(t.phone||""))},[t]);const O=async j=>{if(j.target.files&&j.target.files[0]){const M=j.target.files[0];if(M.size>Ba){I(`La foto debe tener un máximo de ${qe} KB.`),j.target.value="";return}E(!0),await d(M,"profile"),E(!1),j.target.value=""}},P=async j=>{if(j.preventDefault(),!t){I("No se pudo cargar la información del cliente.");return}v(!0);const M={...t,name:x,email:u,state:r,phone:y},G=await p(M);v(!1),G&&n()};return t?e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-client-name",children:"Nombre"}),e.jsx(R,{id:"edit-client-name",type:"text",value:x,onChange:j=>C(j.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-client-email",children:"Correo Electrónico"}),e.jsx(R,{id:"edit-client-email",type:"email",value:u,onChange:j=>N(j.target.value),required:!0,disabled:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-client-state",children:"Estado"}),e.jsxs(Ra,{value:r,onValueChange:m,required:!0,children:[e.jsx(Da,{id:"edit-client-state",children:e.jsx(Ea,{placeholder:"Selecciona un estado"})}),e.jsx(Pa,{children:Ma.map(j=>e.jsx(Ta,{value:j,children:j},j))})]})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-client-phone",children:"Número de Teléfono"}),e.jsx(R,{id:"edit-client-phone",type:"tel",value:y,onChange:j=>f(j.target.value),placeholder:"Ej: 0412-1234567",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"edit-profile-image",children:"Foto de Perfil"}),e.jsx(R,{id:"edit-profile-image",type:"file",accept:"image/*",onChange:O,className:"mt-1",disabled:w}),t.profileImage&&e.jsxs("div",{className:"mt-2 relative w-24 h-24",children:[e.jsx("img",{src:t.profileImage,alt:"Vista previa del perfil",className:"w-24 h-24 rounded-full object-cover"}),w&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-full",children:e.jsx(Re,{className:"h-8 w-8 text-white animate-spin"})})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(k,{type:"button",variant:"outline",onClick:o,disabled:g||w,children:"Cancelar"}),e.jsx(k,{type:"submit",disabled:g||w,children:g?e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):"Guardar Cambios"})]})]}):e.jsx("div",{className:"text-center text-gray-500",children:"Cargando perfil..."})};var Q=(n=>(n.Positive="positive",n.Negative="negative",n.Neutral="neutral",n))(Q||{}),ge="Radio",[Ka,$e]=Le(ge),[Wa,Ya]=Ka(ge),Ve=s.forwardRef((n,o)=>{const{__scopeRadio:l,name:p,checked:d=!1,required:t,disabled:x,value:C="on",onCheck:u,form:N,...r}=n,[m,y]=s.useState(null),f=fe(o,w=>y(w)),g=s.useRef(!1),v=m?N||!!m.closest("form"):!0;return e.jsxs(Wa,{scope:l,checked:d,disabled:x,children:[e.jsx(ne.button,{type:"button",role:"radio","aria-checked":d,"data-state":We(d),"data-disabled":x?"":void 0,disabled:x,value:C,...r,ref:f,onClick:he(n.onClick,w=>{d||u==null||u(),v&&(g.current=w.isPropagationStopped(),g.current||w.stopPropagation())})}),v&&e.jsx(Ke,{control:m,bubbles:!g.current,name:p,value:C,checked:d,required:t,disabled:x,form:N,style:{transform:"translateX(-100%)"}})]})});Ve.displayName=ge;var Be="RadioIndicator",He=s.forwardRef((n,o)=>{const{__scopeRadio:l,forceMount:p,...d}=n,t=Ya(Be,l);return e.jsx(ba,{present:p||t.checked,children:e.jsx(ne.span,{"data-state":We(t.checked),"data-disabled":t.disabled?"":void 0,...d,ref:o})})});He.displayName=Be;var Qa="RadioBubbleInput",Ke=s.forwardRef(({__scopeRadio:n,control:o,checked:l,bubbles:p=!0,...d},t)=>{const x=s.useRef(null),C=fe(x,t),u=Fa(l),N=Ca(o);return s.useEffect(()=>{const r=x.current;if(!r)return;const m=window.HTMLInputElement.prototype,f=Object.getOwnPropertyDescriptor(m,"checked").set;if(u!==l&&f){const g=new Event("click",{bubbles:p});f.call(r,l),r.dispatchEvent(g)}},[u,l,p]),e.jsx(ne.input,{type:"radio","aria-hidden":!0,defaultChecked:l,...d,tabIndex:-1,ref:C,style:{...d.style,...N,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Ke.displayName=Qa;function We(n){return n?"checked":"unchecked"}var Xa=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],le="RadioGroup",[Za,xs]=Le(le,[Ge,$e]),Ye=Ge(),Qe=$e(),[Ja,es]=Za(le),Xe=s.forwardRef((n,o)=>{const{__scopeRadioGroup:l,name:p,defaultValue:d,value:t,required:x=!1,disabled:C=!1,orientation:u,dir:N,loop:r=!0,onValueChange:m,...y}=n,f=Ye(l),g=wa(N),[v,w]=Na({prop:t,defaultProp:d??null,onChange:m,caller:le});return e.jsx(Ja,{scope:l,name:p,required:x,disabled:C,value:v,onValueChange:w,children:e.jsx(za,{asChild:!0,...f,orientation:u,dir:g,loop:r,children:e.jsx(ne.div,{role:"radiogroup","aria-required":x,"aria-orientation":u,"data-disabled":C?"":void 0,dir:g,...y,ref:o})})})});Xe.displayName=le;var Ze="RadioGroupItem",Je=s.forwardRef((n,o)=>{const{__scopeRadioGroup:l,disabled:p,...d}=n,t=es(Ze,l),x=t.disabled||p,C=Ye(l),u=Qe(l),N=s.useRef(null),r=fe(o,N),m=t.value===d.value,y=s.useRef(!1);return s.useEffect(()=>{const f=v=>{Xa.includes(v.key)&&(y.current=!0)},g=()=>y.current=!1;return document.addEventListener("keydown",f),document.addEventListener("keyup",g),()=>{document.removeEventListener("keydown",f),document.removeEventListener("keyup",g)}},[]),e.jsx(La,{asChild:!0,...C,focusable:!x,active:m,children:e.jsx(Ve,{disabled:x,required:t.required,checked:m,...u,...d,name:t.name,ref:r,onCheck:()=>t.onValueChange(d.value),onKeyDown:he(f=>{f.key==="Enter"&&f.preventDefault()}),onFocus:he(d.onFocus,()=>{var f;y.current&&((f=N.current)==null||f.click())})})})});Je.displayName=Ze;var as="RadioGroupIndicator",ea=s.forwardRef((n,o)=>{const{__scopeRadioGroup:l,...p}=n,d=Qe(l);return e.jsx(He,{...d,...p,ref:o})});ea.displayName=as;var aa=Xe,sa=Je,ss=ea;const ta=s.forwardRef(({className:n,...o},l)=>e.jsx(aa,{className:Oe("grid gap-2",n),...o,ref:l}));ta.displayName=aa.displayName;const X=s.forwardRef(({className:n,...o},l)=>e.jsx(sa,{ref:l,className:Oe("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),...o,children:e.jsx(ss,{className:"flex items-center justify-center",children:e.jsx($a,{className:"h-2.5 w-2.5 fill-current text-current"})})}));X.displayName=sa.displayName;const ts=({isOpen:n,onClose:o,contract:l,providerName:p,onCompletionSuccess:d})=>{const{currentUser:t,addFeedbackToProvider:x}=ie(),{handleContractAction:C}=Ue(),[u,N]=s.useState(null),[r,m]=s.useState(""),y=async()=>{if(!u){I("Por favor, selecciona una calificación para el servicio.");return}if(r.trim().length>2e3){I("El comentario no debe exceder los 2000 caracteres.");return}if(r.trim()===""){I("Por favor, escribe un comentario.");return}if(t&&t.id===l.clientId)try{await x(l.providerId,u,r.trim())&&(await C(l.id,t.id,"finalize"),ka("¡Gracias por tu feedback! El contrato ha sido finalizado."),d(),o())}catch(v){console.error("ContractCompletionModal: Error during completion process:",v),I("Ocurrió un error al finalizar el contrato. Intenta de nuevo.")}else I("Solo el cliente que contrató puede finalizar el contrato y dejar feedback.")},f=l.serviceRate*(1-l.commissionRate),g=l.serviceRate*l.commissionRate;return e.jsx(Z,{open:n,onOpenChange:o,children:e.jsxs(J,{className:"sm:max-w-[425px]",children:[e.jsxs(ee,{children:[e.jsx(ae,{children:"Finalizar Contrato y Liberar Fondos"}),e.jsx(se,{children:"Confirma que el servicio ha sido completado satisfactoriamente y deja tu feedback."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("p",{className:"text-lg",children:[e.jsx("span",{className:"font-semibold",children:"Servicio:"})," ",l.serviceTitle]}),e.jsxs("p",{className:"text-lg",children:[e.jsx("span",{className:"font-semibold",children:"Proveedor:"})," ",p]}),e.jsxs("p",{className:"text-lg",children:[e.jsx("span",{className:"font-semibold",children:"Tarifa Total:"})," $",l.serviceRate.toFixed(2)," USD"]}),e.jsxs("p",{className:"text-lg text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"font-semibold",children:"Monto a Liberar al Proveedor:"})," $",f.toFixed(2)," USD"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["(Comisión de la plataforma: $",g.toFixed(2)," USD)"]}),e.jsxs("div",{className:"border-t pt-4 mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Dejar Feedback"}),e.jsxs("div",{children:[e.jsx(A,{className:"mb-2 block",children:"Calificación:"}),e.jsxs(ta,{onValueChange:v=>N(v),value:u||"",className:"flex space-x-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:Q.Positive,id:"rating-positive"}),e.jsx(A,{htmlFor:"rating-positive",children:"Positivo"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:Q.Neutral,id:"rating-neutral"}),e.jsx(A,{htmlFor:"rating-neutral",children:"Neutro"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(X,{value:Q.Negative,id:"rating-negative"}),e.jsx(A,{htmlFor:"rating-negative",children:"Negativo"})]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx(A,{htmlFor:"feedback-comment",className:"mb-2 block",children:"Comentario (máx. 2000 caracteres):"}),e.jsx(_a,{id:"feedback-comment",value:r,onChange:v=>m(v.target.value),maxLength:2e3,placeholder:"Escribe tu comentario aquí (máx. 2000 caracteres)..."})]})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Al confirmar, los fondos serán liberados al proveedor. Esta acción no se puede deshacer."})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(k,{variant:"outline",onClick:o,children:"Cancelar"}),e.jsx(k,{onClick:y,disabled:!u||r.trim()==="",children:"Confirmar y Liberar Fondos"})]})]})})},is=({isOpen:n,onClose:o,serviceTitle:l,negotiatedServiceRate:p,onConfirm:d})=>{const{exchangeRate:t}=ie(),[x,C]=s.useState("binance-pay"),[u,N]=s.useState(""),[r,m]=s.useState(""),[y,f]=s.useState(""),[g,v]=s.useState(""),[w,E]=s.useState(""),[O,P]=s.useState(""),[j,M]=s.useState(""),z=p*(1+.05),H=z*t,K=()=>{if(x==="binance-pay")d(p),o();else if(x==="pago-movil"){if(!w||!O||!j){I("Por favor, completa todos los datos de Pago Móvil.");return}if(O.replace(/\D/g,"").length<7){I("Número de teléfono inválido.");return}if(j.replace(/\D/g,"").length<6){I("Cédula/RIF inválida.");return}d(p),o()}else{if(!u||!r||!y||!g){I("Por favor, completa todos los datos de la tarjeta.");return}if(u.replace(/\s/g,"").length!==16||!/^\d+$/.test(u.replace(/\s/g,""))){I("Número de tarjeta inválido (debe tener 16 dígitos).");return}if(!/^(0[1-9]|1[0-2])\/\d{2}$/.test(r)){I("Fecha de vencimiento inválida (MM/AA).");return}if(y.length!==3||!/^\d+$/.test(y)){I("CVV inválido (debe tener 3 dígitos).");return}d(p),o()}};return e.jsx(Z,{open:n,onOpenChange:o,children:e.jsxs(J,{className:"sm:max-w-[425px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ee,{children:[e.jsxs(ae,{className:"flex items-center justify-center gap-2",children:[e.jsx(Fe,{className:"h-5 w-5 text-green-600"}),"Simulación de Pasarela de Pago"]}),e.jsx(se,{className:"text-center",children:"Estás a punto de depositar fondos para el servicio. El monto es el acordado con el proveedor."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("p",{className:"text-lg text-center",children:[e.jsx("span",{className:"font-semibold",children:"Servicio:"})," ",l]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"payment-amount",className:"text-center block mb-2",children:"Monto del Servicio (USD)"}),e.jsx(R,{id:"payment-amount",type:"text",value:`$${p.toFixed(2)} USD`,readOnly:!0,className:"mt-1 font-bold text-lg text-center"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:"(Incluye una comisión del 5% para la plataforma)"}),e.jsxs("div",{className:"text-center text-2xl font-bold text-blue-600 dark:text-blue-400",children:["Total a Pagar: $",z.toFixed(2)," USD"]}),e.jsxs(Oa,{value:x,onValueChange:C,className:"w-full mt-6",children:[e.jsxs(Ua,{className:"grid w-full grid-cols-2",children:[e.jsxs(De,{value:"binance-pay",className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"})," Binance Pay"]}),e.jsxs(De,{value:"pago-movil",className:"flex items-center gap-2",children:[e.jsx(Va,{className:"h-4 w-4"})," Pago Móvil"]})]}),e.jsx(Ee,{value:"binance-pay",className:"mt-4 space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-700 dark:text-gray-300 mb-2",children:"Escanea el código QR o usa el ID de pago para completar la transacción."}),e.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 p-6 rounded-lg flex flex-col items-center justify-center h-48",children:[e.jsx(_e,{className:"h-24 w-24 text-gray-500 dark:text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"QR de Pago Simulado"}),e.jsxs("p",{className:"text-sm font-semibold text-gray-800 dark:text-gray-200 mt-1",children:["ID de Pago: TE_LO_HAGO_",Math.floor(Math.random()*1e6)]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:["Monto a enviar: ",e.jsxs("span",{className:"font-semibold",children:["$",z.toFixed(2)," USD"]})]})]})}),e.jsx(Ee,{value:"pago-movil",className:"mt-4 space-y-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-md text-gray-700 dark:text-gray-300 mb-2",children:"Realiza la transferencia a los siguientes datos:"}),e.jsxs("div",{className:"bg-gray-200 dark:bg-gray-700 p-4 rounded-lg space-y-3",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"pago-movil-bank",children:"Banco Receptor"}),e.jsx(R,{id:"pago-movil-bank",type:"text",value:"Banco de Venezuela (Simulado)",readOnly:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"pago-movil-phone",children:"Número de Teléfono"}),e.jsx(R,{id:"pago-movil-phone",type:"tel",value:"0412-1234567 (Simulado)",readOnly:!0,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"pago-movil-id",children:"Cédula / RIF"}),e.jsx(R,{id:"pago-movil-id",type:"text",value:"V-12345678 (Simulado)",readOnly:!0,className:"mt-1"})]})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-4",children:["Monto a enviar: ",e.jsxs("span",{className:"font-semibold",children:["$",z.toFixed(2)," USD"]})]}),e.jsxs("p",{className:"text-lg font-bold text-green-600 dark:text-green-400 mt-2",children:["Equivalente en VEF: ",H.toFixed(2)," VEF"]}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h3",{className:"text-md font-semibold text-center",children:"Confirma tus datos de Pago Móvil"}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"confirm-pago-movil-bank",children:"Tu Banco"}),e.jsx(R,{id:"confirm-pago-movil-bank",type:"text",value:w,onChange:T=>E(T.target.value),placeholder:"Ej: Banco Mercantil",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"confirm-pago-movil-phone",children:"Tu Número de Teléfono"}),e.jsx(R,{id:"confirm-pago-movil-phone",type:"tel",value:O,onChange:T=>P(T.target.value.replace(/\D/g,"")),placeholder:"Ej: 04121234567",required:!0})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"confirm-pago-movil-id",children:"Tu Cédula / RIF"}),e.jsx(R,{id:"confirm-pago-movil-id",type:"text",value:j,onChange:T=>M(T.target.value.replace(/\D/g,"")),placeholder:"Ej: V-12345678",required:!0})]})]})]})})]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:"(Este es un pago simulado. No se realizará ninguna transacción real.)"}),e.jsxs("p",{className:"text-xs text-green-700 dark:text-green-300 text-center flex items-center justify-center gap-1",children:[e.jsx(Fe,{className:"h-3 w-3"})," Transacción segura y encriptada"]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(k,{onClick:K,className:"w-full",children:"Confirmar Pago"})})]})})},ns=4,ls=3,ze=10,ps=()=>{var we;const{currentUser:n,allUsers:o,isLoading:l,isLoadingUsers:p}=ie(),{getContractsForUser:d,handleContractAction:t,depositFunds:x,contracts:C,createContract:u}=Ue(),{hasUnreadMessages:N}=Aa(),r=s.useMemo(()=>!l&&n&&n.type==="client"?n:null,[l,n]),m=s.useMemo(()=>o.filter(a=>a.type==="provider"),[o]),y=s.useMemo(()=>o.find(a=>a.type==="admin"),[o]),[f,g]=s.useState(!1),[v,w]=s.useState(""),[E,O]=s.useState(""),[P,j]=s.useState(""),[M,G]=s.useState(!1),[z,H]=s.useState(null),[K,T]=s.useState(!1),[U,ve]=s.useState(null),[je,ye]=s.useState(!1),[re,ia]=s.useState(null),[W,na]=s.useState(void 0),[Ne,be]=s.useState(!1),[Y,la]=s.useState(null),[Ce,ra]=s.useState(ns),[ke,oa]=s.useState(ls),L=s.useMemo(()=>r?d(r.id):[],[r,d]),oe=s.useMemo(()=>{const a=v.toLowerCase();let h=[];return a===""?h=[...m].sort((i,c)=>c.createdAt-i.createdAt).slice(0,6):h=m.filter(i=>i.name.toLowerCase().includes(a)||i.category.toLowerCase().includes(a)||i.serviceTitle.toLowerCase().includes(a)||i.serviceDescription.toLowerCase().includes(a)||i.state.toLowerCase().includes(a)),h},[v,m]),q=s.useMemo(()=>{const a=E.toLowerCase();let h=L.filter(i=>{const c=["finalized","cancelled","finalized_by_dispute"].includes(i.status),D=m.find(_=>_.id===i.providerId),F=D?D.name.toLowerCase():"";return!c&&(i.serviceTitle.toLowerCase().includes(a)||F.includes(a))});return h.sort((i,c)=>{if(i.status==="offered"&&c.status!=="offered")return-1;if(i.status!=="offered"&&c.status==="offered")return 1;const D=i.status==="active"&&i.clientDeposited&&i.providerAction==="finalize"&&i.clientAction!=="finalize"&&i.clientAction!=="cancel"&&i.clientAction!=="dispute",F=c.status==="active"&&c.clientDeposited&&c.providerAction==="finalize"&&c.clientAction!=="finalize"&&c.clientAction!=="cancel"&&c.clientAction!=="dispute";if(D&&!F)return-1;if(!D&&F)return 1;const _=i.status==="active"&&i.clientDeposited&&i.clientAction==="finalize"&&i.providerAction==="none",V=c.status==="active"&&c.clientDeposited&&i.clientAction==="finalize"&&c.providerAction==="none";return _&&!V?-1:!_&&V?1:i.status==="pending"&&c.status!=="pending"?-1:i.status!=="pending"&&c.status==="pending"?1:c.createdAt-i.createdAt}),h.slice(0,Ce)},[L,E,m,Ce]),$=s.useMemo(()=>{const a=P.toLowerCase();let h=L.filter(i=>{const c=["finalized","cancelled","finalized_by_dispute"].includes(i.status),D=m.find(_=>_.id===i.providerId),F=D?D.name.toLowerCase():"";return c&&(i.serviceTitle.toLowerCase().includes(a)||F.includes(a))});return h.sort((i,c)=>c.updatedAt-i.updatedAt),h.slice(0,ke)},[L,P,m,ke]),ca=s.useCallback(()=>{ra(a=>a+ze)},[]),da=s.useCallback(()=>{oa(a=>a+ze)},[]),ma=s.useCallback(async a=>{if(!n||n.type!=="client"){I("Debes iniciar sesión como cliente para solicitar un servicio.");return}await u(n.id,a.id,a.serviceTitle,a.rate||0)},[n,u]),ua=s.useCallback(a=>{ve(a),T(!0)},[]),xa=s.useCallback(async a=>{U&&(await x(U.id),ve(null)),T(!1)},[U,x]),pa=s.useCallback(a=>{H(a),G(!0)},[]),ha=s.useCallback(async a=>{n&&await t(a,n.id,"cancel")},[n,t]),fa=s.useCallback(async a=>{n&&await t(a,n.id,"dispute")},[n,t]),ga=s.useCallback(async a=>{n&&await t(a,n.id,"cancel_dispute")},[n,t]),Ae=s.useCallback((a,h)=>{ia(a),na(h.status),ye(!0)},[]),va=s.useCallback((a,h,i)=>{la({comment:a,clientName:h,feedbackType:i}),be(!0)},[]),ja=s.useCallback(()=>{},[]);return l||p?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ce,{}),e.jsx("div",{className:"flex-grow flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"text-center p-4",children:e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gray-800 dark:text-gray-100",children:"Cargando información..."})})}),e.jsx(de,{})]}):r?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ce,{}),e.jsxs("div",{className:"flex-grow flex flex-col items-center bg-gray-100 dark:bg-gray-900 p-4",children:[e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100 mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-6 text-center",children:["Bienvenido, ",r.name," (Cliente)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Tu Perfil"}),e.jsxs(Pe,{className:"w-24 h-24 mb-4",children:[e.jsx(Me,{src:r.profileImage,alt:`${r.name}'s profile`}),e.jsx(Te,{children:r.name.charAt(0)})]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Correo:"})," ",r.email]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Estado:"})," ",r.state]})]}),e.jsx("div",{className:"flex items-center justify-center md:justify-end",children:e.jsxs(Z,{open:f,onOpenChange:g,children:[e.jsx(Sa,{asChild:!0,children:e.jsx(k,{variant:"default",children:"Editar Información"})}),e.jsxs(J,{className:"sm:max-w-[425px] md:max-w-lg lg:max-w-xl overflow-y-auto max-h-[90vh]",children:[e.jsxs(ee,{children:[e.jsx(ae,{children:"Editar Perfil de Cliente"}),e.jsx(se,{children:"Realiza cambios en tu perfil aquí. Haz clic en guardar cuando hayas terminado."})]}),e.jsx(Ha,{onSave:()=>g(!1),onCancel:()=>g(!1)})]})]})})]})]}),e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Mis Contratos Activos"}),e.jsx("div",{className:"mb-6",children:e.jsx(R,{type:"text",placeholder:"Buscar contratos activos por título de servicio o nombre del proveedor...",value:E,onChange:a=>O(a.target.value),className:"w-full"})}),q.length===0&&E!==""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No se encontraron contratos activos que coincidan con tu búsqueda."}):q.length===0&&E===""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No tienes contratos activos."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:q.map(a=>{const h=m.find(ya=>ya.id===a.providerId),i=h?N(h.id):!1,c=y?N(y.id):!1,D=a.status==="offered"&&a.clientAction==="none",F=a.status==="active"&&a.clientDeposited&&a.providerAction==="finalize"&&a.clientAction!=="finalize"&&a.clientAction!=="cancel"&&a.clientAction!=="dispute",_=a.status==="pending"&&a.clientAction==="none"||a.status==="offered"&&a.clientAction==="none"||a.status==="active"&&a.clientDeposited&&a.providerAction==="cancel"&&a.clientAction==="none",V=a.status==="active"&&a.clientDeposited&&a.clientAction!=="finalize"&&a.clientAction!=="cancel"&&a.clientAction!=="dispute",Se=a.status==="disputed"&&a.clientAction==="dispute",Ie=a.status==="pending"||a.status==="offered"||a.status==="active"||a.status==="disputed";let b="",S="";switch(a.status){case"pending":b="Pendiente (Esperando oferta del proveedor)",S="text-yellow-600";break;case"offered":b="Oferta Recibida (Esperando tu aceptación)",S="text-purple-600";break;case"active":a.clientDeposited&&a.clientAction==="finalize"&&a.providerAction==="none"?(b="Activo (Cliente finalizó, esperando tu confirmación)",S="text-blue-600"):a.clientDeposited&&a.clientAction==="accept_offer"&&a.providerAction==="none"?(b="Activo (Cliente aceptó, esperando tu acción)",S="text-blue-600"):a.providerAction==="finalize"&&a.clientAction!=="finalize"&&a.clientAction!=="cancel"&&a.clientAction!=="dispute"?(b="Activo (Proveedor finalizó, esperando tu confirmación)",S="text-blue-600"):a.clientAction==="cancel"&&a.providerAction==="none"?(b="Cancelación iniciada (Esperando proveedor)",S="text-red-600"):a.providerAction==="cancel"&&a.clientAction==="none"?(b="Cancelación iniciada por proveedor (Esperando tu acción)",S="text-red-600"):a.clientAction==="dispute"?(b="En Disputa (Iniciada por ti)",S="text-orange-600"):(b="Activo",S="text-blue-600");break;case"finalized":b="Finalizado",S="text-green-600";break;case"cancelled":a.clientAction==="cancel"&&a.providerAction!=="cancel"?b="Cancelado por ti":a.providerAction==="cancel"&&a.clientAction!=="cancel"?b="Cancelado por el proveedor":a.clientAction==="cancel"&&a.providerAction==="cancel"?b="Cancelado por ambas partes":b="Cancelado",S="text-red-600";break;case"disputed":b="En Disputa (Esperando resolución)",S="text-orange-600";break;case"finalized_by_dispute":b="Finalizado por Disputa (Admin)",S="text-purple-600";break;default:b="Desconocido",S="text-gray-500"}return e.jsxs(me,{className:"flex flex-col",children:[e.jsxs(ue,{children:[e.jsx(xe,{children:a.serviceTitle}),e.jsxs(B,{children:[e.jsx("span",{className:"font-medium",children:"Proveedor:"})," ",h?h.name:"Desconocido"]}),e.jsxs(B,{children:["Estado:"," ",e.jsx("span",{className:`font-semibold ${S}`,children:b})]})]}),e.jsxs(pe,{className:"flex-grow",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",a.serviceRate.toFixed(2)," USD"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Depósito Cliente:"})," ",a.clientDeposited?"Sí":"No"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tu Acción:"})," ",a.clientAction==="none"?"Pendiente":a.clientAction==="accept_offer"?"Oferta Aceptada":a.clientAction==="finalize"?"Finalizar":a.clientAction==="cancel"?"Cancelar":"Disputar"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Acción Proveedor:"})," ",a.providerAction==="none"?"Pendiente":a.providerAction==="make_offer"?"Oferta Enviada":a.providerAction==="finalize"?"Finalizar":"Cancelar"]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[D&&e.jsx(k,{className:"w-full",onClick:()=>ua(a),children:"Aceptar Oferta y Pagar"}),F&&e.jsx(k,{className:"w-full",onClick:()=>pa(a),children:"Finalizar Contrato"}),_&&e.jsx(k,{variant:"outline",className:"w-full",onClick:()=>ha(a.id),children:"Cancelar Contrato"}),Ie&&h&&e.jsx(k,{className:`w-full ${i?"btn-new-message-pulse":""}`,onClick:()=>Ae(h,a),children:i?"Mensaje Nuevo":"Chatear con Proveedor"}),a.status==="disputed"&&y&&e.jsx(k,{className:`w-full bg-yellow-500 hover:bg-yellow-600 text-white ${c?"btn-new-message-pulse":""}`,onClick:()=>Ae(y,a),children:c?"Mensaje del Admin":"Chatear con Administrador"}),V&&e.jsx(k,{variant:"destructive",className:"w-full",onClick:()=>fa(a.id),children:"Disputar"}),Se&&e.jsx(k,{variant:"outline",className:"w-full bg-yellow-500 hover:bg-yellow-600 text-white",onClick:()=>ga(a.id),children:"Cancelar Disputa"}),!D&&!F&&!_&&!V&&!Se&&!Ie&&a.status!=="finalized"&&a.status!=="cancelled"&&a.status!=="disputed"&&a.status!=="finalized_by_dispute"&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:a.clientAction==="finalize"&&a.providerAction==="none"?"Esperando confirmación del proveedor.":"Esperando acción de la otra parte."})]})]})]},a.id)})}),q.length<L.filter(a=>!["finalized","cancelled","finalized_by_dispute"].includes(a.status)).length&&e.jsx("div",{className:"text-center mt-6",children:e.jsxs(k,{onClick:ca,variant:"outline",children:["Cargar más contratos activos (",L.filter(a=>!["finalized","cancelled","finalized_by_dispute"].includes(a.status)).length-q.length," restantes)"]})})]}),e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Historial de Contratos"}),e.jsx("div",{className:"mb-6",children:e.jsx(R,{type:"text",placeholder:"Buscar en el historial por título de servicio o nombre del proveedor...",value:P,onChange:a=>j(a.target.value),className:"w-full"})}),$.length===0&&P!==""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No se encontraron contratos en el historial que coincidan con tu búsqueda."}):$.length===0&&P===""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No hay contratos en tu historial."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$.map(a=>{const h=m.find(D=>D.id===a.providerId);let i="",c="";switch(a.status){case"finalized":i="Finalizado",c="text-green-600";break;case"cancelled":a.clientAction==="cancel"&&a.providerAction!=="cancel"?i="Cancelado por ti":a.providerAction==="cancel"&&a.clientAction!=="cancel"?i="Cancelado por el proveedor":a.clientAction==="cancel"&&a.providerAction==="cancel"?i="Cancelado por ambas partes":i="Cancelado",c="text-red-600";break;case"finalized_by_dispute":i=`Resuelto por Disputa (${a.disputeResolution==="toClient"?"a Cliente":"a Proveedor"})`,c="text-purple-600";break;default:i="Desconocido",c="text-gray-500"}return e.jsxs(me,{className:"flex flex-col opacity-80",children:[e.jsxs(ue,{children:[e.jsx(xe,{children:a.serviceTitle}),e.jsxs(B,{children:[e.jsx("span",{className:"font-medium",children:"Proveedor:"})," ",h?h.name:"Desconocido"]}),e.jsxs(B,{children:["Estado:"," ",e.jsx("span",{className:`font-semibold ${c}`,children:i})]})]}),e.jsxs(pe,{className:"flex-grow",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",a.serviceRate.toFixed(2)," USD"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Fecha de Actualización:"})," ",new Date(a.updatedAt).toLocaleDateString()]})]})]},a.id)})}),$.length<L.filter(a=>["finalized","cancelled","finalized_by_dispute"].includes(a.status)).length&&e.jsx("div",{className:"text-center mt-6",children:e.jsxs(k,{onClick:da,variant:"outline",children:["Cargar más del historial (",L.filter(a=>["finalized","cancelled","finalized_by_dispute"].includes(a.status)).length-$.length," restantes)"]})})]}),e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Buscar Servicios"}),e.jsx("div",{className:"mb-6",children:e.jsx(R,{type:"text",placeholder:"Buscar proveedores por nombre, categoría, título, descripción o estado...",value:v,onChange:a=>w(a.target.value),className:"w-full"})}),oe.length===0&&v!==""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No se encontraron servicios que coincidan con tu búsqueda."}):oe.length===0&&v===""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No hay proveedores registrados aún."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:oe.map(a=>e.jsxs(me,{className:"flex flex-col",children:[a.serviceImage&&e.jsx("img",{src:a.serviceImage,alt:a.serviceTitle,className:"w-full h-40 object-cover rounded-t-lg"}),e.jsxs(ue,{children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsxs(Pe,{className:"w-10 h-10",children:[e.jsx(Me,{src:a.profileImage,alt:`${a.name}'s profile`}),e.jsx(Te,{children:a.name.charAt(0)})]}),e.jsx(xe,{children:a.serviceTitle})]}),e.jsx(B,{className:"text-gray-600 dark:text-gray-400",children:a.serviceDescription})]}),e.jsxs(pe,{className:"flex-grow",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Proveedor:"})," ",a.name]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Categoría:"})," ",a.category]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Estado:"})," ",a.state]}),e.jsxs("p",{className:"mb-1 text-lg font-bold text-green-600 dark:text-green-400",children:["$",a.rate.toFixed(2)," USD (Tarifa Sugerida)"]}),e.jsxs("div",{className:"flex items-center mt-2",children:[[...Array(5)].map((h,i)=>e.jsx(Ga,{className:`h-5 w-5 ${i<a.starRating?"text-yellow-500 fill-yellow-500":"text-gray-300 dark:text-gray-600"}`},i)),e.jsxs("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:["(",a.starRating," / 5 estrellas)"]})]}),(a.feedback||[]).length>0&&e.jsx(k,{variant:"link",className:"p-0 h-auto mt-2 text-blue-500 dark:text-blue-400",onClick:()=>va(a.feedback[a.feedback.length-1].comment,a.name,a.feedback[a.feedback.length-1].type),children:"Ver último comentario"}),e.jsx(k,{className:"mt-4 w-full",onClick:()=>ma(a),children:"Solicitar Servicio"})]})]},a.id))})]})]}),M&&z&&e.jsx(ts,{isOpen:M,onClose:()=>{H(null),G(!1)},contract:z,providerName:((we=m.find(a=>a.id===z.providerId))==null?void 0:we.name)||"Desconocido",onCompletionSuccess:ja}),K&&U&&e.jsx(is,{isOpen:K,onClose:()=>T(!1),serviceTitle:U.serviceTitle,negotiatedServiceRate:U.serviceRate,onConfirm:xa}),je&&re&&e.jsx(Z,{open:je,onOpenChange:ye,children:e.jsxs(J,{className:"sm:max-w-[425px] md:max-w-lg lg:max-w-2xl h-[80vh] flex flex-col",children:[e.jsxs(ee,{children:[e.jsxs(ae,{children:["Chat con ",re.name]}),e.jsx(se,{children:W==="pending"||W==="offered"||W==="initial_contact"?"Conversación previa al pago. Los números y palabras numéricas sensibles serán enmascarados para proteger tu privacidad.":"Conversación sobre el contrato activo. Los números no serán enmascarados aquí."})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(Ia,{otherUser:re,contractStatus:W})})]})}),Ne&&Y&&e.jsx(qa,{isOpen:Ne,onClose:()=>be(!1),comment:Y.comment,clientName:Y.clientName,feedbackType:Y.feedbackType}),e.jsx(de,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ce,{}),e.jsx("div",{className:"flex-grow flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gray-800 dark:text-gray-100",children:"Acceso Denegado"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Solo los clientes pueden acceder a este panel."})]})}),e.jsx(de,{})]})};export{ps as default};
