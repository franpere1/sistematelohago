import{a as be,r as n,j as e,L as te,B as x,c as Me,s as ie,l as Pe,n as Le,H as ne,M as le}from"./index-CmGxKR2W.js";import{L as j,I as b,D as re,a as ce,b as oe,c as de,d as me,e as Oe}from"./dialog-x9vYFAAS.js";import{S as Ue,C as fe,a as ge,b as ve,c as Y,d as je,e as Re}from"./ChatWindow-CAKZhwK9.js";import{S as qe,a as $e,b as He,c as Be,V as Ve,d as Ge,C as We,T as Ye}from"./textarea-DpdPb1qd.js";import{P as Ze,a as Ke,C as Xe,b as Je,c as Qe,d as es,e as ss,f as as,g as is,h as ts}from"./popover-BjZ5rIVa.js";import{A as ns,a as ls,b as rs,S as cs,F as os}from"./FeedbackCommentModal-C8Auac7q.js";const ye=250,ds=ye*1024,ms=({onSave:o,onCancel:C})=>{const{currentUser:y,updateUser:I,updateUserImage:S}=be(),i=y&&y.type==="provider"?y:null,[m,k]=n.useState((i==null?void 0:i.name)||""),[L,v]=n.useState((i==null?void 0:i.email)||""),[c,D]=n.useState((i==null?void 0:i.state)||""),[Z,T]=n.useState((i==null?void 0:i.phone)||""),[N,K]=n.useState((i==null?void 0:i.category)||""),[w,X]=n.useState((i==null?void 0:i.serviceTitle)||""),[J,F]=n.useState((i==null?void 0:i.serviceDescription)||""),[z,O]=n.useState((i==null?void 0:i.rate)||""),[Q,U]=n.useState(!1),[_,ee]=n.useState(!1),[A,se]=n.useState({profile:!1,service:!1});n.useEffect(()=>{i&&(k(i.name),v(i.email),D(i.state),T(i.phone||""),K(i.category),X(i.serviceTitle),F(i.serviceDescription),O(i.rate))},[i]);const ae=["Abogado","Adiestrador canino","Albañil","Arquitecto","Barbero","Carpintero","Cerrajero","Chef a domicilio","Chofer privado","Clases de idiomas","Clases de música","Clases particulares","Contador","Cuidador de adultos mayores","Electricista","Enfermero(a)","Fumigador","Herrero","Ingeniero","Jardinero","Lavado de autos","Limpieza de casas","Limpieza de oficinas","Maquillador","Manicurista","Masajista","Mecánico","Mesonero","Motorizado / Delivery","Mudanzas","Niñera","Organización de eventos","Paseador de perros","Peluquero","Pintor","Plomero","Repostero","Servicios de sistemas","Servicios digitales","Servicios electrónica","Técnico de aire acondicionado"].sort(),R=async(l,g)=>{if(l.target.files&&l.target.files[0]){const q=l.target.files[0];if(q.size>ds){ie(`La foto debe tener un máximo de ${ye} KB.`),l.target.value="";return}se(P=>({...P,[g]:!0})),await S(q,g),se(P=>({...P,[g]:!1})),l.target.value=""}},E=async l=>{if(l.preventDefault(),!i||!N){ie("Por favor, completa todos los campos requeridos.");return}ee(!0);try{const g={...i,name:m,email:L,state:c,phone:Z,category:N,serviceTitle:w,serviceDescription:J,rate:Number(z)};await I(g)&&o()}catch(g){console.error("Error inesperado en handleSubmit:",g),ie("Ocurrió un error inesperado al guardar los cambios.")}finally{ee(!1),console.log("Finalizó handleSubmit")}};if(!i)return e.jsx("div",{className:"text-center text-gray-500",children:"Cargando perfil..."});const M=_||A.profile||A.service;return e.jsxs("form",{onSubmit:E,className:"space-y-4",children:[e.jsx(j,{htmlFor:"edit-name",children:"Nombre"}),e.jsx(b,{id:"edit-name",type:"text",value:m,onChange:l=>k(l.target.value),required:!0}),e.jsx(j,{htmlFor:"edit-email",children:"Correo Electrónico"}),e.jsx(b,{id:"edit-email",type:"email",value:L,onChange:l=>v(l.target.value),required:!0,disabled:!0}),e.jsx(j,{htmlFor:"edit-state",children:"Estado"}),e.jsxs(qe,{value:c,onValueChange:D,required:!0,children:[e.jsx($e,{id:"edit-state",children:e.jsx(He,{placeholder:"Selecciona un estado"})}),e.jsx(Be,{children:Ve.map(l=>e.jsx(Ge,{value:l,children:l},l))})]}),e.jsx(j,{htmlFor:"edit-phone",children:"Número de Teléfono"}),e.jsx(b,{id:"edit-phone",type:"tel",value:Z,onChange:l=>T(l.target.value),placeholder:"Ej: 0412-1234567",required:!0}),e.jsx(j,{htmlFor:"edit-profile-image",children:"Foto de Perfil"}),e.jsx(b,{id:"edit-profile-image",type:"file",accept:"image/*",onChange:l=>R(l,"profile"),className:"mt-1",disabled:M}),i.profileImage&&e.jsxs("div",{className:"mt-2 relative w-24 h-24",children:[e.jsx("img",{src:i.profileImage,alt:"Vista previa del perfil",className:"w-24 h-24 rounded-full object-cover"}),A.profile&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-full",children:e.jsx(te,{className:"h-8 w-8 text-white animate-spin"})})]}),e.jsx(j,{htmlFor:"edit-category",children:"Categoría del Servicio"}),e.jsxs(Ze,{open:Q,onOpenChange:U,children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(x,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[N||"Selecciona una categoría...",e.jsx(Xe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Je,{className:"w-[--radix-popover-trigger-width] p-0",children:e.jsxs(Qe,{children:[e.jsx(es,{placeholder:"Buscar categoría..."}),e.jsxs(ss,{children:[e.jsx(as,{children:"No se encontró."}),e.jsx(is,{children:ae.map(l=>e.jsxs(ts,{value:l,onSelect:g=>{K(g),U(!1)},children:[e.jsx(We,{className:Me("mr-2 h-4 w-4",N===l?"opacity-100":"opacity-0")}),l]},l))})]})]})})]}),e.jsx(j,{htmlFor:"edit-service-title",children:"Título del Servicio"}),e.jsx(b,{id:"edit-service-title",type:"text",value:w,onChange:l=>X(l.target.value),placeholder:"Ej: Plomero a domicilio",required:!0}),e.jsx(j,{htmlFor:"edit-service-description",children:"Descripción Breve (máx. 50 caracteres)"}),e.jsx(Ye,{id:"edit-service-description",value:J,onChange:l=>F(l.target.value),maxLength:50,required:!0}),e.jsx(j,{htmlFor:"edit-service-image",children:"Imagen del Servicio"}),e.jsx(b,{id:"edit-service-image",type:"file",accept:"image/*",onChange:l=>R(l,"service"),className:"mt-1",disabled:M}),i.serviceImage&&e.jsxs("div",{className:"mt-2 relative w-full h-48",children:[e.jsx("img",{src:i.serviceImage,alt:"Vista previa del servicio",className:"w-full h-48 object-cover rounded-md"}),A.service&&e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center rounded-md",children:e.jsx(te,{className:"h-12 w-12 text-white animate-spin"})})]}),e.jsx(j,{htmlFor:"edit-rate",children:"Tarifa por Servicio (USD)"}),e.jsx(b,{id:"edit-rate",type:"number",value:z,onChange:l=>O(parseFloat(l.target.value)||""),placeholder:"Ej: 50",required:!0,min:"0",step:"0.01"}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(x,{type:"button",variant:"outline",onClick:C,disabled:M,children:"Cancelar"}),e.jsx(x,{type:"submit",disabled:M,children:_?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"mr-2 h-4 w-4 animate-spin"}),"Guardando..."]}):"Guardar Cambios"})]})]})},us=({isOpen:o,onClose:C,contractId:y,serviceTitle:I,initialRate:S,onConfirmOffer:i})=>{const[m,k]=n.useState(S),L=()=>{const v=parseFloat(String(m));if(isNaN(v)||v<=0){ie("Por favor, introduce un monto válido mayor que cero.");return}i(y,v),C()};return e.jsx(re,{open:o,onOpenChange:C,children:e.jsxs(ce,{className:"sm:max-w-[425px]",children:[e.jsxs(oe,{children:[e.jsxs(de,{children:["Hacer Oferta para ",I]}),e.jsx(me,{children:"Introduce el monto que ofreces para realizar este servicio."})]}),e.jsxs("div",{className:"py-4 space-y-4",children:[e.jsxs("p",{className:"text-lg",children:[e.jsx("span",{className:"font-semibold",children:"Servicio:"})," ",I]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Tarifa sugerida inicialmente: $",S.toFixed(2)," USD"]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"offer-amount",children:"Monto de tu Oferta (USD)"}),e.jsx(b,{id:"offer-amount",type:"number",value:m,onChange:v=>k(v.target.value),placeholder:"Ingresa tu oferta",required:!0,min:"0.01",step:"0.01",className:"mt-1"})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(x,{variant:"outline",onClick:C,children:"Cancelar"}),e.jsx(x,{onClick:L,disabled:!m||parseFloat(String(m))<=0,children:"Enviar Oferta"})]})]})})},Ce=150,xs=4,ps=3,Ne=10,Ns=()=>{var pe;const{currentUser:o,allUsers:C,isLoading:y,isLoadingUsers:I,refreshCurrentUser:S}=be(),{getContractsForUser:i,handleContractAction:m,makeOffer:k,contracts:L}=Pe(),{hasUnreadMessages:v}=Le(),c=n.useMemo(()=>!y&&o&&o.type==="provider"?o:null,[y,o]),D=n.useMemo(()=>C.find(s=>s.type==="admin"),[C]),[Z,T]=n.useState(!1),[N,K]=n.useState(""),[w,X]=n.useState(""),[J,F]=n.useState(!1),[z,O]=n.useState(null),[Q,U]=n.useState(!1),[_,ee]=n.useState(null),[A,se]=n.useState(void 0),[ae,R]=n.useState(!1),[E,M]=n.useState(null),l=n.useMemo(()=>{const s=new Map;return C.forEach(r=>s.set(r.id,r)),s},[C]),[g,q]=n.useState(xs),[P,Ae]=n.useState(ps),ue=n.useRef(),f=n.useMemo(()=>c?i(c.id):[],[c,i]);n.useEffect(()=>{const s=ue.current;s&&c&&f.some(a=>{const t=s.find(p=>p.id===a.id);return a.status==="finalized"&&(t==null?void 0:t.status)!=="finalized"||a.status==="finalized_by_dispute"&&(t==null?void 0:t.status)!=="finalized_by_dispute"})&&S(),ue.current=f},[f,S,c]);const $=n.useMemo(()=>{const s=N.toLowerCase();let r=f.filter(a=>{const t=["finalized","cancelled","finalized_by_dispute"].includes(a.status),u=l.get(a.clientId),p=u?u.name.toLowerCase():"";return!t&&(a.serviceTitle.toLowerCase().includes(s)||p.includes(s))});return r.sort((a,t)=>{if(a.status==="pending"&&t.status!=="pending")return-1;if(a.status!=="pending"&&t.status==="pending")return 1;if(a.status==="offered"&&t.status!=="offered")return-1;if(a.status!=="offered"&&t.status==="offered")return 1;const u=a.status==="active"&&a.clientDeposited&&a.clientAction==="finalize"&&a.providerAction==="none",p=t.status==="active"&&t.clientDeposited&&t.clientAction==="finalize"&&t.providerAction==="none";if(u&&!p)return-1;if(!u&&p)return 1;const B=a.status==="active"&&a.clientDeposited&&a.providerAction==="finalize"&&a.clientAction!=="finalize"&&a.clientAction!=="cancel"&&a.clientAction!=="dispute",V=t.status==="active"&&t.clientDeposited&&t.providerAction==="finalize"&&t.clientAction!=="finalize"&&t.clientAction!=="cancel"&&t.clientAction!=="dispute";if(B&&!V)return-1;if(!B&&V)return 1;const G=a.status==="active"&&a.clientDeposited&&a.clientAction==="accept_offer"&&a.providerAction==="none",W=t.status==="active"&&t.clientDeposited&&a.clientAction==="accept_offer"&&t.providerAction==="none";return G&&!W?-1:!G&&W?1:t.createdAt-a.createdAt}),r.slice(0,g)},[f,N,l,g]),H=n.useMemo(()=>{const s=w.toLowerCase();let r=f.filter(a=>{const t=["finalized","cancelled","finalized_by_dispute"].includes(a.status),u=l.get(a.clientId),p=u?u.name.toLowerCase():"";return t&&(a.serviceTitle.toLowerCase().includes(s)||p.includes(s))});return r.sort((a,t)=>t.updatedAt-a.updatedAt),r.slice(0,P)},[f,w,l,P]),we=n.useMemo(()=>f.reduce((s,r)=>r.status==="finalized"||r.status==="finalized_by_dispute"&&r.disputeResolution==="toProvider"?s+r.serviceRate*(1-r.commissionRate):s,0),[f]),Se=n.useCallback(()=>{q(s=>s+Ne)},[]),ke=n.useCallback(()=>{Ae(s=>s+Ne)},[]),De=n.useCallback(async s=>{o&&await m(s,o.id,"finalize")},[o,m]),ze=n.useCallback(async s=>{o&&await m(s,o.id,"cancel")},[o,m]),Ie=n.useCallback(async s=>{o&&await m(s,o.id,"dispute")},[o,m]),Te=n.useCallback(async s=>{o&&await m(s,o.id,"cancel_dispute")},[o,m]),Fe=n.useCallback(s=>{O(s),F(!0)},[]),_e=n.useCallback(async(s,r)=>{await k(s,r),F(!1),O(null)},[k]),xe=n.useCallback(async(s,r)=>{ee(s),se(r.status),U(!0)},[]),Ee=n.useCallback(async(s,r,a)=>{const t=l.get(r);t&&(M({comment:s,clientName:t.name,feedbackType:a}),R(!0))},[l]);return y||I?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ne,{}),e.jsx("div",{className:"flex-grow flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsx("div",{className:"text-center p-4",children:e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gray-800 dark:text-gray-100",children:"Cargando información..."})})}),e.jsx(le,{})]}):c?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ne,{}),e.jsxs("div",{className:"flex-grow flex flex-col items-center bg-gray-100 dark:bg-gray-900 p-4",children:[e.jsxs("div",{className:"w-full max-w-2xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100 mb-8",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-6 text-center",children:["Bienvenido, ",c.name," (Proveedor)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center md:items-start",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Tu Perfil"}),e.jsxs(ns,{className:"w-24 h-24 mb-4",children:[e.jsx(ls,{src:c.profileImage,alt:`${c.name}'s profile`}),e.jsx(rs,{children:c.name.charAt(0)})]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Correo:"})," ",c.email]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Estado:"})," ",c.state]}),e.jsxs("p",{className:"mb-2 text-lg font-bold text-green-600 dark:text-green-400",children:[e.jsx("span",{className:"font-medium",children:"Ganancias Acumuladas:"})," $",we.toFixed(2)," USD"]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:"Tu Servicio"}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Categoría:"})," ",c.category]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Título:"})," ",c.serviceTitle]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Descripción:"})," ",c.serviceDescription]}),e.jsxs("p",{className:"mb-2",children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",((pe=c.rate)==null?void 0:pe.toFixed(2))||"0.00"," USD"]}),c.serviceImage&&e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"font-medium block mb-2",children:"Imagen del Servicio:"}),e.jsx("img",{src:c.serviceImage,alt:"Imagen del Servicio",className:"w-full h-48 object-cover rounded-md shadow-sm"})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Calificación:"}),e.jsxs("div",{className:"flex items-center",children:[[...Array(5)].map((s,r)=>e.jsx(cs,{className:`h-6 w-6 ${r<c.starRating?"text-yellow-500 fill-yellow-500":"text-gray-300 dark:text-gray-600"}`},r)),e.jsxs("span",{className:"ml-2 text-lg font-medium",children:["(",c.starRating," / 5 estrellas)"]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-semibold mb-2 text-lg",children:"Comentarios Recientes:"}),e.jsx(Ue,{className:"h-40 w-full rounded-md border p-4",children:(c.feedback||[]).length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:"No hay comentarios aún."}):e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-600 dark:text-gray-400",children:[...c.feedback||[]].reverse().map((s,r)=>{var p;const a=s.comment.length>Ce,t=a?`${s.comment.substring(0,Ce)}...`:s.comment,u=((p=l.get(s.clientId))==null?void 0:p.name)||"Cliente Desconocido";return e.jsxs("li",{className:"break-words mb-2",children:[e.jsx("span",{className:`font-medium ${s.type==="positive"?"text-green-600":s.type==="negative"?"text-red-600":"text-gray-500"}`,children:s.type==="positive"?"Positivo":s.type==="negative"?"Negativo":"Neutro"}),': "',t,'"',a&&e.jsx(x,{variant:"link",className:"p-0 h-auto ml-1 text-blue-500 dark:text-blue-400",onClick:()=>Ee(s.comment,u,s.type),children:"Ver más"})]},r)})})})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs(re,{open:Z,onOpenChange:T,children:[e.jsx(Oe,{asChild:!0,children:e.jsx(x,{variant:"default",children:"Editar Información"})}),e.jsxs(ce,{className:"sm:max-w-[425px] md:max-w-lg lg:max-w-xl overflow-y-auto max-h-[90vh]",children:[e.jsxs(oe,{children:[e.jsx(de,{children:"Editar Perfil de Proveedor"}),e.jsx(me,{children:"Realiza cambios en tu perfil aquí. Haz clic en guardar cuando hayas terminado."})]}),e.jsx(ms,{onSave:()=>T(!1),onCancel:()=>T(!1)})]})]})})]}),e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Mis Contratos Activos"}),e.jsx("div",{className:"mb-6",children:e.jsx(b,{type:"text",placeholder:"Buscar contratos activos por título de servicio o nombre del cliente...",value:N,onChange:s=>K(s.target.value),className:"w-full"})}),$.length===0&&N!==""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No se encontraron contratos activos que coincidan con tu búsqueda."}):$.length===0&&N===""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No tienes contratos activos."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:$.map(s=>{const r=l.get(s.clientId),a=r?v(r.id):!1,t=D?v(D.id):!1,u=s.providerAction==="dispute"||s.providerAction==="dispute_from_finalize",p=s.status==="pending"&&s.providerAction==="none",B=s.status==="active"&&s.clientDeposited&&s.providerAction!=="finalize"&&s.providerAction!=="cancel"&&!u&&s.clientAction!=="cancel"&&s.clientAction!=="dispute",V=s.status==="pending"&&s.providerAction==="none"||s.status==="offered"&&s.providerAction==="make_offer"&&!s.clientDeposited,G=s.status==="active"&&s.clientDeposited&&!u&&s.clientAction!=="finalize"&&s.clientAction!=="cancel"&&s.clientAction!=="dispute",W=s.status==="disputed"&&u,he=s.status==="pending"||s.status==="offered"||s.status==="active"||s.status==="disputed";let d="",h="";switch(s.status){case"pending":d="Pendiente (Esperando tu oferta)",h="text-yellow-600";break;case"offered":d="Ofertado (Esperando aceptación del cliente)",h="text-purple-600";break;case"active":s.clientDeposited&&s.clientAction==="finalize"&&s.providerAction==="none"?(d="Activo (Cliente finalizó, esperando tu confirmación)",h="text-blue-600"):s.clientDeposited&&s.clientAction==="accept_offer"&&s.providerAction==="none"?(d="Activo (Cliente aceptó, esperando tu acción)",h="text-blue-600"):s.providerAction==="finalize"&&s.clientAction!=="finalize"&&s.clientAction!=="cancel"&&s.clientAction!=="dispute"?(d="Activo (Esperando confirmación del cliente)",h="text-blue-600"):s.clientAction==="cancel"&&s.providerAction==="none"?(d="Cancelación iniciada por cliente (Esperando tu acción)",h="text-red-600"):s.providerAction==="cancel"&&s.clientAction==="none"?(d="Cancelación iniciada (Esperando cliente)",h="text-red-600"):(d="Activo (En curso)",h="text-blue-600");break;case"finalized":d="Finalizado",h="text-green-600";break;case"cancelled":s.clientAction==="cancel"&&s.providerAction!=="cancel"?d="Cancelado por el cliente":s.providerAction==="cancel"&&s.clientAction!=="cancel"?d="Cancelado por ti":s.clientAction==="cancel"&&s.providerAction==="cancel"?d="Cancelado por ambas partes":d="Cancelado",h="text-red-600";break;case"disputed":d=`En Disputa (${s.clientAction==="dispute"?"Iniciada por cliente":"Iniciada por ti"})`,h="text-orange-600";break;case"finalized_by_dispute":d="Finalizado por Disputa (Admin)",h="text-purple-600";break;default:d="Desconocido",h="text-gray-500"}return e.jsxs(fe,{className:"flex flex-col",children:[e.jsxs(ge,{children:[e.jsx(ve,{children:s.serviceTitle}),e.jsxs(Y,{children:[e.jsx("span",{className:"font-medium",children:"Cliente:"})," ",r?r.name:"Desconocido"]}),e.jsxs(Y,{children:[e.jsx("span",{className:"font-medium",children:"Fecha:"})," ",new Date(s.createdAt).toLocaleDateString()]}),e.jsxs(Y,{children:["Estado:"," ",e.jsx("span",{className:`font-semibold ${h}`,children:d})]})]}),e.jsxs(je,{className:"flex-grow",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",s.serviceRate.toFixed(2)," USD"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Depósito Cliente:"})," ",s.clientDeposited?"Sí":"No"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tu Acción:"})," ",s.providerAction==="none"?"Pendiente":s.providerAction==="make_offer"?"Oferta Enviada":s.providerAction==="finalize"?"Finalizar":u?"Disputar":"Cancelar"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Acción Cliente:"})," ",s.clientAction==="none"?"Pendiente":s.clientAction==="accept_offer"?"Oferta Aceptada":s.clientAction==="finalize"?"Finalizar":s.clientAction==="cancel"?"Cancelar":s.clientAction==="dispute"?"Disputar":"Cancelar Disputa"]}),e.jsxs("div",{className:"flex flex-col gap-2 mt-4",children:[p&&e.jsx(x,{className:"w-full",onClick:()=>Fe(s),children:"Hacer Oferta"}),B&&e.jsx(x,{className:"w-full",onClick:()=>De(s.id),children:"Finalizar Contrato"}),V&&e.jsx(x,{variant:"outline",className:"w-full",onClick:()=>ze(s.id),children:"Cancelar Contrato"}),G&&e.jsx(x,{variant:"destructive",className:"w-full",onClick:()=>Ie(s.id),children:"Disputar"}),W&&e.jsx(x,{variant:"outline",className:"w-full bg-yellow-500 hover:bg-yellow-600 text-white",onClick:()=>Te(s.id),children:"Cancelar Disputa"}),he&&r&&e.jsx(x,{className:`w-full ${a?"btn-new-message-pulse":""}`,onClick:()=>xe(r,s),children:a?"Mensaje Nuevo":"Chatear con Cliente"}),s.status==="disputed"&&D&&e.jsx(x,{className:`w-full bg-yellow-500 hover:bg-yellow-600 text-white ${t?"btn-new-message-pulse":""}`,onClick:()=>xe(D,s),children:t?"Mensaje del Admin":"Chatear con Administrador"}),!p&&!B&&!V&&!G&&!W&&!he&&s.status!=="finalized"&&s.status!=="cancelled"&&s.status!=="disputed"&&s.status!=="finalized_by_dispute"&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center",children:s.providerAction==="finalize"&&s.clientAction==="none"?"Esperando confirmación del cliente.":"Esperando acción del cliente."})]})]})]},s.id)})}),$.length<f.filter(s=>!["finalized","cancelled","finalized_by_dispute"].includes(s.status)).length&&e.jsx("div",{className:"text-center mt-6",children:e.jsxs(x,{onClick:Se,variant:"outline",children:["Cargar más contratos activos (",f.filter(s=>!["finalized","cancelled","finalized_by_dispute"].includes(s.status)).length-$.length," restantes)"]})})]}),e.jsxs("div",{className:"w-full max-w-4xl bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md text-gray-800 dark:text-gray-100",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-center",children:"Historial de Contratos"}),e.jsx("div",{className:"mb-6",children:e.jsx(b,{type:"text",placeholder:"Buscar en el historial por título de servicio o nombre del cliente...",value:w,onChange:s=>X(s.target.value),className:"w-full"})}),H.length===0&&w!==""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No se encontraron contratos en el historial que coincidan con tu búsqueda."}):H.length===0&&w===""?e.jsx("p",{className:"text-center text-gray-600 dark:text-gray-400",children:"No hay contratos en tu historial."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:H.map(s=>{const r=l.get(s.clientId);let a="",t="";switch(s.status){case"finalized":a="Finalizado",t="text-green-600";break;case"cancelled":s.clientAction==="cancel"&&s.providerAction!=="cancel"?a="Cancelado por el cliente":s.providerAction==="cancel"&&s.clientAction!=="cancel"?a="Cancelado por ti":s.clientAction==="cancel"&&s.providerAction==="cancel"?a="Cancelado por ambas partes":a="Cancelado",t="text-red-600";break;case"finalized_by_dispute":a=`Resuelto por Disputa (${s.disputeResolution==="toClient"?"a Cliente":"a Proveedor"})`,t="text-purple-600";break;default:a="Desconocido",t="text-gray-500"}return e.jsxs(fe,{className:"flex flex-col opacity-80",children:[e.jsxs(ge,{children:[e.jsx(ve,{children:s.serviceTitle}),e.jsxs(Y,{children:[e.jsx("span",{className:"font-medium",children:"Cliente:"})," ",r?r.name:"Desconocido"]}),e.jsxs(Y,{children:["Estado:"," ",e.jsx("span",{className:`font-semibold ${t}`,children:a})]})]}),e.jsxs(je,{className:"flex-grow",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Tarifa:"})," $",s.serviceRate.toFixed(2)," USD"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"Fecha de Actualización:"})," ",new Date(s.updatedAt).toLocaleDateString()]})]})]},s.id)})}),H.length<f.filter(s=>["finalized","cancelled","finalized_by_dispute"].includes(s.status)).length&&e.jsx("div",{className:"text-center mt-6",children:e.jsxs(x,{onClick:ke,variant:"outline",children:["Cargar más del historial (",f.filter(s=>["finalized","cancelled","finalized_by_dispute"].includes(s.status)).length-H.length," restantes)"]})})]})]}),z&&e.jsx(us,{isOpen:J,onClose:()=>F(!1),contractId:z.id,serviceTitle:z.serviceTitle,initialRate:z.serviceRate,onConfirmOffer:_e}),Q&&_&&e.jsx(re,{open:Q,onOpenChange:U,children:e.jsxs(ce,{className:"sm:max-w-[425px] md:max-w-lg lg:max-w-2xl h-[80vh] flex flex-col",children:[e.jsxs(oe,{children:[e.jsxs(de,{children:["Chat con ",_.name]}),e.jsx(me,{children:A==="pending"||A==="offered"||A==="initial_contact"?"Conversación previa al pago. Los números y palabras numéricas sensibles serán enmascarados para proteger tu privacidad.":"Conversación sobre el contrato activo. Los números no serán enmascarados aquí."})]}),e.jsx("div",{className:"flex-grow overflow-hidden",children:e.jsx(Re,{otherUser:_,contractStatus:A})})]})}),ae&&E&&e.jsx(os,{isOpen:ae,onClose:()=>R(!1),comment:E.comment,clientName:E.clientName,feedbackType:E.feedbackType}),e.jsx(le,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(ne,{}),e.jsx("div",{className:"flex-grow flex items-center justify-center bg-gray-100 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"text-center p-4",children:[e.jsx("h1",{className:"text-4xl font-bold mb-4 text-gray-800 dark:text-gray-100",children:"Acceso Denegado"}),e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Solo los proveedores pueden acceder a este panel."})]})}),e.jsx(le,{})]})};export{Ns as default};
