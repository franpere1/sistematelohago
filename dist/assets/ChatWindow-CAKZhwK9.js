import{r as n,j as c,c as C,g as N,f as ie,P as W,i as O,h as y,p as P,z as de,a as ue,n as fe,B as he,s as me}from"./index-CmGxKR2W.js";import{u as be,j as pe,I as ve}from"./dialog-x9vYFAAS.js";const ge=n.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:C("rounded-lg border bg-card text-card-foreground shadow-sm",e),...t}));ge.displayName="Card";const Se=n.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:C("flex flex-col space-y-1.5 p-6",e),...t}));Se.displayName="CardHeader";const we=n.forwardRef(({className:e,...t},r)=>c.jsx("h3",{ref:r,className:C("text-2xl font-semibold leading-none tracking-tight",e),...t}));we.displayName="CardTitle";const xe=n.forwardRef(({className:e,...t},r)=>c.jsx("p",{ref:r,className:C("text-sm text-muted-foreground",e),...t}));xe.displayName="CardDescription";const Ce=n.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:C("p-6 pt-0",e),...t}));Ce.displayName="CardContent";const Re=n.forwardRef(({className:e,...t},r)=>c.jsx("div",{ref:r,className:C("flex items-center p-6 pt-0",e),...t}));Re.displayName="CardFooter";function Pe(e,t){return n.useReducer((r,l)=>t[r][l]??r,e)}var B="ScrollArea",[Z,Oe]=ie(B),[ye,g]=Z(B),q=n.forwardRef((e,t)=>{const{__scopeScrollArea:r,type:l="hover",dir:o,scrollHideDelay:s=600,...a}=e,[i,d]=n.useState(null),[m,h]=n.useState(null),[u,f]=n.useState(null),[b,v]=n.useState(null),[E,H]=n.useState(null),[x,_]=n.useState(0),[A,L]=n.useState(0),[D,R]=n.useState(!1),[z,I]=n.useState(!1),p=N(t,T=>d(T)),S=be(o);return c.jsx(ye,{scope:r,type:l,dir:S,scrollHideDelay:s,scrollArea:i,viewport:m,onViewportChange:h,content:u,onContentChange:f,scrollbarX:b,onScrollbarXChange:v,scrollbarXEnabled:D,onScrollbarXEnabledChange:R,scrollbarY:E,onScrollbarYChange:H,scrollbarYEnabled:z,onScrollbarYEnabledChange:I,onCornerWidthChange:_,onCornerHeightChange:L,children:c.jsx(W.div,{dir:S,...a,ref:p,style:{position:"relative","--radix-scroll-area-corner-width":x+"px","--radix-scroll-area-corner-height":A+"px",...e.style}})})});q.displayName=B;var K="ScrollAreaViewport",G=n.forwardRef((e,t)=>{const{__scopeScrollArea:r,children:l,nonce:o,...s}=e,a=g(K,r),i=n.useRef(null),d=N(t,i,a.onViewportChange);return c.jsxs(c.Fragment,{children:[c.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),c.jsx(W.div,{"data-radix-scroll-area-viewport":"",...s,ref:d,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:c.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:l})})]})});G.displayName=K;var w="ScrollAreaScrollbar",V=n.forwardRef((e,t)=>{const{forceMount:r,...l}=e,o=g(w,e.__scopeScrollArea),{onScrollbarXEnabledChange:s,onScrollbarYEnabledChange:a}=o,i=e.orientation==="horizontal";return n.useEffect(()=>(i?s(!0):a(!0),()=>{i?s(!1):a(!1)}),[i,s,a]),o.type==="hover"?c.jsx(Ee,{...l,ref:t,forceMount:r}):o.type==="scroll"?c.jsx(Ae,{...l,ref:t,forceMount:r}):o.type==="auto"?c.jsx(J,{...l,ref:t,forceMount:r}):o.type==="always"?c.jsx(F,{...l,ref:t}):null});V.displayName=w;var Ee=n.forwardRef((e,t)=>{const{forceMount:r,...l}=e,o=g(w,e.__scopeScrollArea),[s,a]=n.useState(!1);return n.useEffect(()=>{const i=o.scrollArea;let d=0;if(i){const m=()=>{window.clearTimeout(d),a(!0)},h=()=>{d=window.setTimeout(()=>a(!1),o.scrollHideDelay)};return i.addEventListener("pointerenter",m),i.addEventListener("pointerleave",h),()=>{window.clearTimeout(d),i.removeEventListener("pointerenter",m),i.removeEventListener("pointerleave",h)}}},[o.scrollArea,o.scrollHideDelay]),c.jsx(O,{present:r||s,children:c.jsx(J,{"data-state":s?"visible":"hidden",...l,ref:t})})}),Ae=n.forwardRef((e,t)=>{const{forceMount:r,...l}=e,o=g(w,e.__scopeScrollArea),s=e.orientation==="horizontal",a=Y(()=>d("SCROLL_END"),100),[i,d]=Pe("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return n.useEffect(()=>{if(i==="idle"){const m=window.setTimeout(()=>d("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(m)}},[i,o.scrollHideDelay,d]),n.useEffect(()=>{const m=o.viewport,h=s?"scrollLeft":"scrollTop";if(m){let u=m[h];const f=()=>{const b=m[h];u!==b&&(d("SCROLL"),a()),u=b};return m.addEventListener("scroll",f),()=>m.removeEventListener("scroll",f)}},[o.viewport,s,d,a]),c.jsx(O,{present:r||i!=="hidden",children:c.jsx(F,{"data-state":i==="hidden"?"hidden":"visible",...l,ref:t,onPointerEnter:y(e.onPointerEnter,()=>d("POINTER_ENTER")),onPointerLeave:y(e.onPointerLeave,()=>d("POINTER_LEAVE"))})})}),J=n.forwardRef((e,t)=>{const r=g(w,e.__scopeScrollArea),{forceMount:l,...o}=e,[s,a]=n.useState(!1),i=e.orientation==="horizontal",d=Y(()=>{if(r.viewport){const m=r.viewport.offsetWidth<r.viewport.scrollWidth,h=r.viewport.offsetHeight<r.viewport.scrollHeight;a(i?m:h)}},10);return j(r.viewport,d),j(r.content,d),c.jsx(O,{present:l||s,children:c.jsx(F,{"data-state":s?"visible":"hidden",...o,ref:t})})}),F=n.forwardRef((e,t)=>{const{orientation:r="vertical",...l}=e,o=g(w,e.__scopeScrollArea),s=n.useRef(null),a=n.useRef(0),[i,d]=n.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=oe(i.viewport,i.content),h={...l,sizes:i,onSizesChange:d,hasThumb:m>0&&m<1,onThumbChange:f=>s.current=f,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:f=>a.current=f};function u(f,b){return De(f,a.current,i,b)}return r==="horizontal"?c.jsx(Te,{...h,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){const f=o.viewport.scrollLeft,b=$(f,i,o.dir);s.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:f=>{o.viewport&&(o.viewport.scrollLeft=f)},onDragScroll:f=>{o.viewport&&(o.viewport.scrollLeft=u(f,o.dir))}}):r==="vertical"?c.jsx(je,{...h,ref:t,onThumbPositionChange:()=>{if(o.viewport&&s.current){const f=o.viewport.scrollTop,b=$(f,i);s.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:f=>{o.viewport&&(o.viewport.scrollTop=f)},onDragScroll:f=>{o.viewport&&(o.viewport.scrollTop=u(f))}}):null}),Te=n.forwardRef((e,t)=>{const{sizes:r,onSizesChange:l,...o}=e,s=g(w,e.__scopeScrollArea),[a,i]=n.useState(),d=n.useRef(null),m=N(t,d,s.onScrollbarXChange);return n.useEffect(()=>{d.current&&i(getComputedStyle(d.current))},[d]),c.jsx(ee,{"data-orientation":"horizontal",...o,ref:m,sizes:r,style:{bottom:0,left:s.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:s.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":X(r)+"px",...e.style},onThumbPointerDown:h=>e.onThumbPointerDown(h.x),onDragScroll:h=>e.onDragScroll(h.x),onWheelScroll:(h,u)=>{if(s.viewport){const f=s.viewport.scrollLeft+h.deltaX;e.onWheelScroll(f),le(f,u)&&h.preventDefault()}},onResize:()=>{d.current&&s.viewport&&a&&l({content:s.viewport.scrollWidth,viewport:s.viewport.offsetWidth,scrollbar:{size:d.current.clientWidth,paddingStart:M(a.paddingLeft),paddingEnd:M(a.paddingRight)}})}})}),je=n.forwardRef((e,t)=>{const{sizes:r,onSizesChange:l,...o}=e,s=g(w,e.__scopeScrollArea),[a,i]=n.useState(),d=n.useRef(null),m=N(t,d,s.onScrollbarYChange);return n.useEffect(()=>{d.current&&i(getComputedStyle(d.current))},[d]),c.jsx(ee,{"data-orientation":"vertical",...o,ref:m,sizes:r,style:{top:0,right:s.dir==="ltr"?0:void 0,left:s.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":X(r)+"px",...e.style},onThumbPointerDown:h=>e.onThumbPointerDown(h.y),onDragScroll:h=>e.onDragScroll(h.y),onWheelScroll:(h,u)=>{if(s.viewport){const f=s.viewport.scrollTop+h.deltaY;e.onWheelScroll(f),le(f,u)&&h.preventDefault()}},onResize:()=>{d.current&&s.viewport&&a&&l({content:s.viewport.scrollHeight,viewport:s.viewport.offsetHeight,scrollbar:{size:d.current.clientHeight,paddingStart:M(a.paddingTop),paddingEnd:M(a.paddingBottom)}})}})}),[Ne,Q]=Z(w),ee=n.forwardRef((e,t)=>{const{__scopeScrollArea:r,sizes:l,hasThumb:o,onThumbChange:s,onThumbPointerUp:a,onThumbPointerDown:i,onThumbPositionChange:d,onDragScroll:m,onWheelScroll:h,onResize:u,...f}=e,b=g(w,r),[v,E]=n.useState(null),H=N(t,p=>E(p)),x=n.useRef(null),_=n.useRef(""),A=b.viewport,L=l.content-l.viewport,D=P(h),R=P(d),z=Y(u,10);function I(p){if(x.current){const S=p.clientX-x.current.left,T=p.clientY-x.current.top;m({x:S,y:T})}}return n.useEffect(()=>{const p=S=>{const T=S.target;(v==null?void 0:v.contains(T))&&D(S,L)};return document.addEventListener("wheel",p,{passive:!1}),()=>document.removeEventListener("wheel",p,{passive:!1})},[A,v,L,D]),n.useEffect(R,[l,R]),j(v,z),j(b.content,z),c.jsx(Ne,{scope:r,scrollbar:v,hasThumb:o,onThumbChange:P(s),onThumbPointerUp:P(a),onThumbPositionChange:R,onThumbPointerDown:P(i),children:c.jsx(W.div,{...f,ref:H,style:{position:"absolute",...f.style},onPointerDown:y(e.onPointerDown,p=>{p.button===0&&(p.target.setPointerCapture(p.pointerId),x.current=v.getBoundingClientRect(),_.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),I(p))}),onPointerMove:y(e.onPointerMove,I),onPointerUp:y(e.onPointerUp,p=>{const S=p.target;S.hasPointerCapture(p.pointerId)&&S.releasePointerCapture(p.pointerId),document.body.style.webkitUserSelect=_.current,b.viewport&&(b.viewport.style.scrollBehavior=""),x.current=null})})})}),k="ScrollAreaThumb",re=n.forwardRef((e,t)=>{const{forceMount:r,...l}=e,o=Q(k,e.__scopeScrollArea);return c.jsx(O,{present:r||o.hasThumb,children:c.jsx(_e,{ref:t,...l})})}),_e=n.forwardRef((e,t)=>{const{__scopeScrollArea:r,style:l,...o}=e,s=g(k,r),a=Q(k,r),{onThumbPositionChange:i}=a,d=N(t,u=>a.onThumbChange(u)),m=n.useRef(void 0),h=Y(()=>{m.current&&(m.current(),m.current=void 0)},100);return n.useEffect(()=>{const u=s.viewport;if(u){const f=()=>{if(h(),!m.current){const b=ze(u,i);m.current=b,i()}};return i(),u.addEventListener("scroll",f),()=>u.removeEventListener("scroll",f)}},[s.viewport,h,i]),c.jsx(W.div,{"data-state":a.hasThumb?"visible":"hidden",...o,ref:d,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...l},onPointerDownCapture:y(e.onPointerDownCapture,u=>{const b=u.target.getBoundingClientRect(),v=u.clientX-b.left,E=u.clientY-b.top;a.onThumbPointerDown({x:v,y:E})}),onPointerUp:y(e.onPointerUp,a.onThumbPointerUp)})});re.displayName=k;var U="ScrollAreaCorner",te=n.forwardRef((e,t)=>{const r=g(U,e.__scopeScrollArea),l=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&l?c.jsx(Le,{...e,ref:t}):null});te.displayName=U;var Le=n.forwardRef((e,t)=>{const{__scopeScrollArea:r,...l}=e,o=g(U,r),[s,a]=n.useState(0),[i,d]=n.useState(0),m=!!(s&&i);return j(o.scrollbarX,()=>{var u;const h=((u=o.scrollbarX)==null?void 0:u.offsetHeight)||0;o.onCornerHeightChange(h),d(h)}),j(o.scrollbarY,()=>{var u;const h=((u=o.scrollbarY)==null?void 0:u.offsetWidth)||0;o.onCornerWidthChange(h),a(h)}),m?c.jsx(W.div,{...l,ref:t,style:{width:s,height:i,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function M(e){return e?parseInt(e,10):0}function oe(e,t){const r=e/t;return isNaN(r)?0:r}function X(e){const t=oe(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,l=(e.scrollbar.size-r)*t;return Math.max(l,18)}function De(e,t,r,l="ltr"){const o=X(r),s=o/2,a=t||s,i=o-a,d=r.scrollbar.paddingStart+a,m=r.scrollbar.size-r.scrollbar.paddingEnd-i,h=r.content-r.viewport,u=l==="ltr"?[0,h]:[h*-1,0];return ne([d,m],u)(e)}function $(e,t,r="ltr"){const l=X(t),o=t.scrollbar.paddingStart+t.scrollbar.paddingEnd,s=t.scrollbar.size-o,a=t.content-t.viewport,i=s-l,d=r==="ltr"?[0,a]:[a*-1,0],m=pe(e,d);return ne([0,a],[0,i])(m)}function ne(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const l=(t[1]-t[0])/(e[1]-e[0]);return t[0]+l*(r-e[0])}}function le(e,t){return e>0&&e<t}var ze=(e,t=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},l=0;return function o(){const s={left:e.scrollLeft,top:e.scrollTop},a=r.left!==s.left,i=r.top!==s.top;(a||i)&&t(),r=s,l=window.requestAnimationFrame(o)}(),()=>window.cancelAnimationFrame(l)};function Y(e,t){const r=P(e),l=n.useRef(0);return n.useEffect(()=>()=>window.clearTimeout(l.current),[]),n.useCallback(()=>{window.clearTimeout(l.current),l.current=window.setTimeout(r,t)},[r,t])}function j(e,t){const r=P(t);de(()=>{let l=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(l),l=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(l),o.unobserve(e)}}},[e,r])}var se=q,We=G,He=te;const ae=n.forwardRef(({className:e,children:t,...r},l)=>c.jsxs(se,{ref:l,className:C("relative overflow-hidden",e),...r,children:[c.jsx(We,{className:"h-full w-full rounded-[inherit]",children:t}),c.jsx(ce,{}),c.jsx(He,{})]}));ae.displayName=se.displayName;const ce=n.forwardRef(({className:e,orientation:t="vertical",...r},l)=>c.jsx(V,{ref:l,orientation:t,className:C("flex touch-none select-none transition-colors",t==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",t==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...r,children:c.jsx(re,{className:"relative flex-1 rounded-full bg-border"})}));ce.displayName=V.displayName;const Xe=({otherUser:e,contractStatus:t})=>{const{currentUser:r}=ue(),{sendMessage:l,getMessagesForConversation:o,markMessagesAsRead:s}=fe(),[a,i]=n.useState(""),d=n.useRef(null),m=o(e.id);n.useEffect(()=>{r&&e&&s(e.id)},[r,e,m,s]);const h=u=>{if(u.preventDefault(),a.trim()&&r){let f=a.trim(),b=!1;if(t==="pending"||t==="offered"||t==="initial_contact"){/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g.test(f)&&(b=!0),/(^|\s)@([a-zA-Z0-9_.]+)\b/g.test(f)&&(b=!0),/\b\d{7,}\b/g.test(f)&&(b=!0);const A=["cero","uno","dos","tres","cuatro","cinco","seis","siete","ocho","nueve","diez","once","doce","trece","catorce","quince","dieciséis","diecisiete","dieciocho","diecinueve","veinte","treinta","cuarenta","cincuenta","sesenta","setenta","ochenta","noventa","cien","ciento","mil","millón","millones"].join("|");new RegExp(`\\b(${A})\\s+(${A})\\b`,"gi").test(f)&&(b=!0),/(https?:\/\/[^\s]+|www\.[^\s]+|[a-zA-Z0-9-]+\.(com|org|net|ve|co|es)[^\s]*)/g.test(f)&&(b=!0);const R=["instagram","tiktok","email","telefono","whatsapp","facebook","twitter","telegram","discord","linkedin","gmail","hotmail","outlook","yahoo","contacto","celular","movil","número","numero","llámame","escríbeme","mi número","mi correo","encuéntrame","fuera de la app","directo","personal","whatsappme","telegramme","discordme","skype","zoom","google meet","dirección","ubicación","cita","reunión","visita","domicilio","casa","oficina","local","calle","avenida","zona","sector","punto de referencia","coordenadas","gps","mapa","encuentro","vernos","hablamos","contactar","comunicar","reunirse"];if(new RegExp(`\\b(${R.join("|")})\\b`,"gi").test(f)&&(b=!0),b){me("Tu mensaje contiene información sensible (contactos, números, enlaces o intentos de comunicación externa) y no puede ser enviado antes de que el contrato esté activo. Por favor, mantén la conversación dentro de la plataforma."),i("");return}}l(e.id,f),i("")}};return n.useEffect(()=>{var u;(u=d.current)==null||u.scrollIntoView({behavior:"smooth"})},[m]),r?c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsxs(ae,{className:"flex-grow p-4 space-y-4",children:[m.length===0?c.jsxs("div",{className:"text-center text-gray-500",children:["Inicia una conversación con ",e.name,"."]}):m.map(u=>c.jsx("div",{className:`flex ${u.senderId===r.id?"justify-end":"justify-start"}`,children:c.jsxs("div",{className:`max-w-[70%] p-3 rounded-lg ${u.senderId===r.id?"bg-blue-500 text-white":"bg-gray-200 text-gray-800 dark:bg-gray-700 dark:text-gray-200"}`,children:[c.jsx("p",{className:"text-sm",children:u.text}),c.jsx("span",{className:"text-xs opacity-75 mt-1 block",children:new Date(u.timestamp).toLocaleTimeString()})]})},u.id)),c.jsx("div",{ref:d})]}),c.jsxs("form",{onSubmit:h,className:"flex p-4 border-t",children:[c.jsx(ve,{type:"text",value:a,onChange:u=>i(u.target.value),placeholder:"Escribe un mensaje...",className:"flex-grow mr-2"}),c.jsx(he,{type:"submit",children:"Enviar"})]})]}):c.jsx("div",{className:"text-center text-gray-500",children:"Inicia sesión para chatear."})};export{ge as C,ae as S,Se as a,we as b,xe as c,Ce as d,Xe as e};
